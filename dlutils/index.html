<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>src/dlutils</title>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="nimdoc.out.css?v=2.1.1">

<!-- JS -->
<script type="text/javascript" src="dochack.js?v=2.1.1"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">src/dlutils</h1>
      <div class="row">
  <div class="three columns">
    <div class="theme-select-wrapper">
      <label for="theme-select">Theme:&nbsp;</label>
      <select id="theme-select" onchange="setTheme(this.value)">
        <option value="auto">ðŸŒ— Match OS</option>
        <option value="dark">ðŸŒ‘ Dark</option>
        <option value="light">ðŸŒ• Light</option>
      </select>
    </div>
    <div id="global-links">
      <ul class="simple">
        <li><a id="indexLink" href="theindex.html">Index</a></li>
      </ul>
    </div>
    <div id="searchInputDiv">
      Search: <input type="search" id="searchInput" oninput="search()"/>
    </div>
    <div>
      Group by:
      <select onchange="groupBy(this.value)">
        <option value="section">Section</option>
        <option value="type">Type</option>
      </select>
    </div>
    <ul class="simple simple-toc" id="toc-list">
  <li><a class="reference" id="usage_toc" href="#usage">Usage</a></li>
<ul class="simple"><li><a class="reference" id="usage-open-proc_toc" href="#usage-open-proc">Open proc</a></li>
<li><a class="reference" id="usage-close-proc_toc" href="#usage-close-proc">Close proc</a></li>
<li><a class="reference" id="usage-error-proc_toc" href="#usage-error-proc">Error proc</a></li>
</ul><li><a class="reference" id="example_toc" href="#example">Example</a></li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#17" id="67">Macros</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">dlgencalls
  <li><a class="reference" href="#dlgencalls.m%2Cstaticstring%2CstaticopenArray%5Bstring%5D%2Cuntyped" title="dlgencalls(name: static string; libpaths: static openArray[string];
           body: untyped): untyped">dlgencalls(name: static string; libpaths: static openArray[string];
           body: untyped): untyped</a></li>

</ul>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#18" id="68">Templates</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">dlgencalls
  <li><a class="reference" href="#dlgencalls.t%2Cstaticstring%2Cstaticstring%2Cuntyped" title="dlgencalls(name: static string; libpath: static string; body: untyped): untyped">dlgencalls(name: static string; libpath: static string; body: untyped): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">unchecked
  <li><a class="reference" href="#unchecked.t" title="unchecked()">unchecked()</a></li>

</ul>

    </ul>
  </details>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
    
    <div id="tocRoot"></div>
    
    <p class="module-desc">Nim package for easy shared library loading.
<h1><a class="toc-backref" id="usage" href="#usage">Usage</a></h1><p><pre class="listing">
<span class="Identifier">dlgencalls</span> <span class="StringLit">&quot;somelib&quot;</span><span class="Punctuation">,</span> <span class="Identifier">paths</span><span class="Punctuation">:</span>
  <span class="Comment"># proc and var definitions</span></pre></p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">dlgencalls</span></span></tt> creates three procs: <tt class="docutils literal"><span class="pre"><span class="Keyword">proc</span> <span class="Identifier">open_somelib_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Keyword">proc</span> <span class="Identifier">close_somelib_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Keyword">proc</span> <span class="Identifier">last_somelib_error</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>.</p>

<h2><a class="toc-backref" id="usage-open-proc" href="#usage-open-proc">Open proc</a></h2><p>The open proc tries to load shared library defined in paths and loads all symbols defined in body. Paths may be either single string or an array of strings. Subsequent calls are ignored.</p>
<p>The open proc returns <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> on success or <tt class="docutils literal"><span class="pre"><span class="Identifier">false</span></span></tt> on error (no library found, one of symbols not found).</p>
<p>Procs and variables marked with <a class="reference internal nimdoc" title="template unchecked()" href="#unchecked.t">unchecked</a> pragma do not cause open function to faile and are set to <tt class="docutils literal"><span class="pre"><span class="Keyword">nil</span></span></tt>.</p>
<p>Allowed definitions in body:</p>
<ul class="simple"><li>proc: <tt class="docutils literal"><span class="pre"><span class="Keyword">proc</span> <span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">cint</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">cint</span></span></tt></li>
<li>var: <tt class="docutils literal"><span class="pre"><span class="Keyword">var</span> <span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">cint</span></span></tt></li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">where</span></span></tt> statement</li>
</ul>
<p>Not allowed in body:</p>
<ul class="simple"><li>export marker <tt class="docutils literal"><span class="pre"><span class="Operator">*</span></span></tt> in variable; all functions and variables are exported by default</li>
<li>multiple variables in single <tt class="docutils literal"><span class="pre"><span class="Keyword">var</span></span></tt> statement; use single <tt class="docutils literal"><span class="pre"><span class="Keyword">var</span></span></tt> statement per variable</li>
</ul>
<p>Allowed <tt class="docutils literal"><span class="pre"><span class="Keyword">proc</span></span></tt> pragmas:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">importc</span><span class="Punctuation">:</span> <span class="StringLit">&quot;source_name&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> - used when original name is invalid in Nim or you want to change it</li>
<li><tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">unchecked</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> - used when definiton is optional - the proc pointer is set to <tt class="docutils literal"><span class="pre"><span class="Keyword">nil</span></span></tt> if no such proc is found in library</li>
<li><tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">varargs</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> - used when proc takes varargs</li>
</ul>
<p>Allowed <tt class="docutils literal"><span class="pre"><span class="Keyword">var</span></span></tt> pragmas:</p>
<ul class="simple"><li><tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">importc</span><span class="Punctuation">:</span> <span class="StringLit">&quot;source_name&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> - used when original name is invalid in Nim or you want to change it</li>
<li><tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">unchecked</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> - used when defintion is optional</li>
</ul>
<p>All other proc/var pragmas are ignored.</p>
<div class="admonition admonition-warning"><span class="admonition-warning-text"><b>Warning:</b></span>
Do not add <tt class="docutils literal"><span class="pre"><span class="Keyword">ptr</span></span></tt> to variable type, it's done automatically (variable of type <tt class="docutils literal"><span class="pre"><span class="Identifier">cint</span></span></tt> becomes <tt class="docutils literal"><span class="pre"><span class="Keyword">ptr</span> <span class="Identifier">cint</span></span></tt>).</div>

<h2><a class="toc-backref" id="usage-close-proc" href="#usage-close-proc">Close proc</a></h2><p>The close proc unloads the shared library. All symbols loaded are set to <tt class="docutils literal"><span class="pre"><span class="Keyword">nil</span></span></tt>. Subsequent calls are ignored.</p>

<h2><a class="toc-backref" id="usage-error-proc" href="#usage-error-proc">Error proc</a></h2><p>The error proc returns a human-readable string describing the most recent error that occured from a call to <tt class="docutils literal"><span class="pre"><span class="Identifier">open_name_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> or empty string on no error.</p>
<p>The returned string does not include a trailing newline.</p>

<h1><a class="toc-backref" id="example" href="#example">Example</a></h1><p>Source:</p>
<p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">dlutils</span>

<span class="Comment"># Create open_math_library, close_math_library, last_math_error</span>
<span class="Comment"># and proc/var symbols defined in body.</span>

<span class="Identifier">dlgencalls</span> <span class="StringLit">&quot;math&quot;</span><span class="Punctuation">,</span> <span class="Punctuation">[</span><span class="StringLit">&quot;libm.so&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;libm.so.6&quot;</span><span class="Punctuation">]</span><span class="Punctuation">:</span>
  <span class="Comment"># Required proc. open_math_library returns false if not found.</span>
  <span class="Keyword">proc</span> <span class="Identifier">cbrt</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">cdouble</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">cdouble</span>
  
  <span class="Comment"># Optional proc. open_math_library sets sqrt to nil if not found.</span>
  <span class="Keyword">proc</span> <span class="Identifier">sqrt</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">cdouble</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">cdouble</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">unchecked</span><span class="Operator">.</span><span class="Punctuation">}</span>
  
  <span class="Comment"># Function &quot;sqrtf&quot; imported as &quot;sqrt2&quot;.</span>
  <span class="Keyword">proc</span> <span class="Identifier">sqrt2</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">cfloat</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">cfloat</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">importc</span><span class="Punctuation">:</span> <span class="StringLit">&quot;sqrtf&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span>
  
  <span class="Comment"># Required var of type ptr cint.</span>
  <span class="Keyword">var</span> <span class="Identifier">reqvar</span><span class="Punctuation">:</span> <span class="Identifier">cint</span>
  
  <span class="Comment"># Optional var of type ptr clong.</span>
  <span class="Keyword">var</span> <span class="Identifier">optvar</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">unchecked</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">:</span> <span class="Identifier">clong</span></pre></p>
<p>Generated code:</p>
<p><pre class="listing">
<span class="Keyword">import</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">dynlib</span>

<span class="Keyword">var</span> <span class="Identifier">math_handle</span><span class="Punctuation">:</span> <span class="Identifier">LibHandle</span> <span class="Operator">=</span> <span class="Keyword">nil</span>

<span class="Keyword">var</span> <span class="Identifier">cbrt</span><span class="Operator">*:</span> <span class="Keyword">proc</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">cdouble</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">cdouble</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">cdecl</span><span class="Punctuation">,</span> <span class="Identifier">gcsafe</span><span class="Punctuation">,</span> <span class="Identifier">raises</span><span class="Punctuation">:</span> <span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
<span class="Keyword">var</span> <span class="Identifier">sqrt</span><span class="Operator">*:</span> <span class="Keyword">proc</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">cdouble</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">cdouble</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">cdecl</span><span class="Punctuation">,</span> <span class="Identifier">gcsafe</span><span class="Punctuation">,</span> <span class="Identifier">raises</span><span class="Punctuation">:</span> <span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
<span class="Keyword">var</span> <span class="Identifier">sqrt2</span><span class="Operator">*:</span> <span class="Keyword">proc</span> <span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">cfloat</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">cfloat</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">cdecl</span><span class="Punctuation">,</span> <span class="Identifier">gcsafe</span><span class="Punctuation">,</span> <span class="Identifier">raises</span><span class="Punctuation">:</span> <span class="Punctuation">[</span><span class="Punctuation">]</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
<span class="Keyword">var</span> <span class="Identifier">reqvar</span><span class="Operator">*:</span> <span class="Keyword">ptr</span> <span class="Identifier">cint</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
<span class="Keyword">var</span> <span class="Identifier">optvar</span><span class="Operator">*:</span> <span class="Keyword">ptr</span> <span class="Identifier">clong</span> <span class="Operator">=</span> <span class="Keyword">nil</span>

<span class="Keyword">proc</span> <span class="Identifier">open_math_library</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span> <span class="Operator">=</span>
  <span class="Identifier">result</span> <span class="Operator">=</span>
    <span class="Comment">##  Open library.</span>
    <span class="Keyword">if</span> <span class="Identifier">math_handle</span> <span class="Operator">==</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
      <span class="Identifier">math_handle</span> <span class="Operator">=</span> <span class="Identifier">loadLib</span> <span class="StringLit">&quot;libm.so&quot;</span>
      <span class="Keyword">if</span> <span class="Identifier">math_handle</span> <span class="Operator">==</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
        <span class="Keyword">return</span> <span class="Identifier">false</span>
      <span class="Identifier">cbrt</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Identifier">cbrt</span><span class="Operator">.</span><span class="Keyword">type</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">symAddr</span><span class="Punctuation">(</span><span class="Identifier">math_handle</span><span class="Punctuation">,</span> <span class="StringLit">&quot;cbrt&quot;</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
      <span class="Keyword">if</span> <span class="Identifier">cbrt</span> <span class="Operator">==</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
        <span class="Keyword">return</span> <span class="Identifier">false</span>
      <span class="Identifier">sqrt</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Identifier">sqrt</span><span class="Operator">.</span><span class="Keyword">type</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">symAddr</span><span class="Punctuation">(</span><span class="Identifier">math_handle</span><span class="Punctuation">,</span> <span class="StringLit">&quot;sqrt&quot;</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
      <span class="Identifier">sqrt2</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Identifier">sqrt2</span><span class="Operator">.</span><span class="Keyword">type</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">symAddr</span><span class="Punctuation">(</span><span class="Identifier">math_handle</span><span class="Punctuation">,</span> <span class="StringLit">&quot;sqrtf&quot;</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
      <span class="Keyword">if</span> <span class="Identifier">sqrt2</span> <span class="Operator">==</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
        <span class="Keyword">return</span> <span class="Identifier">false</span>
      <span class="Identifier">reqvar</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Identifier">reqvar</span><span class="Operator">.</span><span class="Keyword">type</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">symAddr</span><span class="Punctuation">(</span><span class="Identifier">math_handle</span><span class="Punctuation">,</span> <span class="StringLit">&quot;reqvar&quot;</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
      <span class="Keyword">if</span> <span class="Identifier">reqvar</span> <span class="Operator">==</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
        <span class="Keyword">return</span> <span class="Identifier">false</span>
      <span class="Identifier">optvar</span> <span class="Operator">=</span> <span class="Keyword">cast</span><span class="Punctuation">[</span><span class="Identifier">optvar</span><span class="Operator">.</span><span class="Keyword">type</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="Identifier">symAddr</span><span class="Punctuation">(</span><span class="Identifier">math_handle</span><span class="Punctuation">,</span> <span class="StringLit">&quot;optvar&quot;</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
    <span class="Identifier">true</span>

<span class="Keyword">proc</span> <span class="Identifier">close_math_library</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment">##  Close library.</span>
  <span class="Keyword">if</span> <span class="Identifier">math_handle</span> <span class="Operator">!=</span> <span class="Keyword">nil</span><span class="Punctuation">:</span>
    <span class="Identifier">cbrt</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
    <span class="Identifier">sqrt</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
    <span class="Identifier">sqrt2</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
    <span class="Identifier">reqvar</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
    <span class="Identifier">optvar</span> <span class="Operator">=</span> <span class="Keyword">nil</span>
    <span class="Identifier">math_handle</span><span class="Operator">.</span><span class="Identifier">unloadLib</span>
    <span class="Identifier">math_handle</span> <span class="Operator">=</span> <span class="Keyword">nil</span>

<span class="Keyword">proc</span> <span class="Identifier">last_math_error</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">##  Returns the most recent error that occured from a call to open proc.</span>
  <span class="LongComment">#[
    code followsâ€¦
  ]#</span></pre></p>
</p>
    <div class="section" id="17">
  <h1><a class="toc-backref" href="#17">Macros</a></h1>
  <dl class="item">
    <div id="dlgencalls-macros-all">
  <div id="dlgencalls.m,staticstring,staticopenArray[string],untyped">
  <dt><pre><span class="Keyword">macro</span> <a href="#dlgencalls.m%2Cstaticstring%2CstaticopenArray%5Bstring%5D%2Cuntyped"><span class="Identifier">dlgencalls</span></a><span class="Other">(</span><span class="Identifier">name</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">libpaths</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">string</span><span class="Other">]</span><span class="Other">;</span>
                 <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    <p>Create <tt class="docutils literal"><span class="pre"><span class="Identifier">open_name_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">close_name_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">last_name_error</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span></span></tt> and C procedures/variables declared in <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>.</p>
<p>Function <tt class="docutils literal"><span class="pre"><span class="Identifier">open_name_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> tries to load shared libary defined in <tt class="docutils literal"><span class="pre"><span class="Identifier">libpaths</span></span></tt> and loads all symbols defined in <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>. This function returns <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt> on success or <tt class="docutils literal"><span class="pre"><span class="Identifier">false</span></span></tt> on error (no library found, symbol not found). Functions and variables marked with <a class="reference internal nimdoc" title="template unchecked()" href="#unchecked.t">unchecked</a> pragam are set to <tt class="docutils literal"><span class="pre"><span class="Keyword">nil</span></span></tt>. Subsequent calls are ignored.</p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">close_name_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> proc unloads the shared library. All symbols loaded are set to <tt class="docutils literal"><span class="pre"><span class="Keyword">nil</span></span></tt>. Subsequent calls are ignored.</p>
<p><tt class="docutils literal"><span class="pre"><span class="Identifier">last_name_error</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> proc returns a human-readable string describing the most recent error that occured from a call to <tt class="docutils literal"><span class="pre"><span class="Identifier">open_name_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt> or empty string on no error.</p>
<p>The returned string does not include a trailing newline.</p>

    
  </dd>
</div>

</div>

  </dl>
</div>
<div class="section" id="18">
  <h1><a class="toc-backref" href="#18">Templates</a></h1>
  <dl class="item">
    <div id="dlgencalls-templates-all">
  <div id="dlgencalls.t,staticstring,staticstring,untyped">
  <dt><pre><span class="Keyword">template</span> <a href="#dlgencalls.t%2Cstaticstring%2Cstaticstring%2Cuntyped"><span class="Identifier">dlgencalls</span></a><span class="Other">(</span><span class="Identifier">name</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">libpath</span><span class="Other">:</span> <span class="Identifier">static</span> <span class="Identifier">string</span><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    <p>Create <tt class="docutils literal"><span class="pre"><span class="Identifier">open_name_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">close_name_library</span><span class="Punctuation">(</span><span class="Punctuation">)</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">last_name_error</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span></span></tt> and C procedures/variables declared in <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt>.</p>
<p>Accepts single library path.</p>
<p>See <a class="reference external" href="#dlgencalls,staticstring,staticopenArray[string],untyped">dlgencalls</a> for details.</p>

    
  </dd>
</div>

</div>
<div id="unchecked-templates-all">
  <div id="unchecked.t">
  <dt><pre><span class="Keyword">template</span> <a href="#unchecked.t"><span class="Identifier">unchecked</span></a><span class="Other">(</span><span class="Other">)</span> {.<span class="Identifier">pragma</span>.}</pre></dt>
  <dd>
    
    Functions and variables marked with this pragma do not cause open proc to fail and are set to <tt class="docutils literal"><span class="pre"><span class="Keyword">nil</span></span></tt> if not found in shared library.
    
  </dd>
</div>

</div>

  </dl>
</div>

  </div>
</div>

      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2023-11-29 21:25:14 UTC</small>
      </div>
    </div>
  </div>
  
  <!-- Google fonts -->
  <link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>
</body>
</html>
